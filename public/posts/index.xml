<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on 0x30</title>
        <link>//localhost:1313/posts/</link>
        <description>Recent content in Posts on 0x30</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Wed, 29 Jan 2025 22:21:15 +0100</lastBuildDate>
        <atom:link href="//localhost:1313/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>How to parse a HID report descriptor</title>
            <link>//localhost:1313/posts/a-tour-of-hid/a-tour-of-hid/</link>
            <pubDate>Wed, 29 Jan 2025 22:21:15 +0100</pubDate>
            
            <guid>//localhost:1313/posts/a-tour-of-hid/a-tour-of-hid/</guid>
            <description>&lt;h2 id=&#34;introduction&#34;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;HID stands for &lt;strong&gt;H&lt;/strong&gt;uman &lt;strong&gt;I&lt;/strong&gt;nterface &lt;strong&gt;D&lt;/strong&gt;evice. It&amp;rsquo;s a device class definition to replace PS/2, was designed for USB but is bus-agnostic.&lt;/p&gt;
&lt;p&gt;The HID specification specifies the structure of hid reports, which will be sent from the &lt;em&gt;device&lt;/em&gt; (probably your microcontroller) to the &lt;em&gt;host&lt;/em&gt; (probably a PC).&lt;/p&gt;
&lt;p&gt;A HID report is structured like so:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;0x05, 0x0d,                         // USAGE_PAGE (Digitizers)          
0x09, 0x04,                         // USAGE (Touch Screen)             
0xa1, 0x01,                         // COLLECTION (Application)         
0x85, 0x01,                         //   REPORT_ID (Touch)              
0x09, 0x22,                         //   USAGE (Finger)                 
0xa1, 0x02,                         //     COLLECTION (Logical)  
0x09, 0x42,                         //       USAGE (Tip Switch)           
0x15, 0x00,                         //       LOGICAL_MINIMUM (0)          
0x25, 0x01,                         //       LOGICAL_MAXIMUM (1)          
0x75, 0x01,                         //       REPORT_SIZE (1)              
0x95, 0x01,                         //       REPORT_COUNT (1)             
0x81, 0x02,                         //       INPUT (Data,Var,Abs) 
0x95, 0x07,                         //       REPORT_COUNT (7)  
0x81, 0x03,                         //       INPUT (Cnst,Ary,Abs)
0x75, 0x08,                         //       REPORT_SIZE (8)
0x09, 0x51,                         //       USAGE (Contact Identifier)
0x95, 0x01,                         //       REPORT_COUNT (1)             
0x81, 0x02,                         //       INPUT (Data,Var,Abs) 
0x05, 0x01,                         //       USAGE_PAGE (Generic Desk..
0x26, 0xff, 0x0f,                   //       LOGICAL_MAXIMUM (4095)         
0x75, 0x10,                         //       REPORT_SIZE (16)             
0x55, 0x0e,                         //       UNIT_EXPONENT (-2)           
0x65, 0x13,                         //       UNIT(Inch,EngLinear)                  
0x09, 0x30,                         //       USAGE (X)                    
0x35, 0x00,                         //       PHYSICAL_MINIMUM (0)         
0x46, 0xb5, 0x04,                   //       PHYSICAL_MAXIMUM (1205)
0x95, 0x02,                         //       REPORT_COUNT (2)         
0x81, 0x02,                         //       INPUT (Data,Var,Abs)         
0x46, 0x8a, 0x03,                   //       PHYSICAL_MAXIMUM (906)
0x09, 0x31,                         //       USAGE (Y)                    
0x81, 0x02,                         //       INPUT (Data,Var,Abs)
0x05, 0x0d,                         //       USAGE_PAGE (Digitizers)
0x09, 0x48,                         //       USAGE (Width)                
0x09, 0x49,                         //       USAGE (Height)               
0x81, 0x02,                         //       INPUT (Data,Var,Abs)
0x95, 0x01,                         //       REPORT_COUNT (1)
0x55, 0x0C,                         //       UNIT_EXPONENT (-4)           
0x65, 0x12,                         //       UNIT (Radians,SIROtation)        
0x35, 0x00,                         //       PHYSICAL_MINIMUM (0)         
0x47, 0x6f, 0xf5, 0x00, 0x00,       //       PHYSICAL_MAXIMUM (62831)      
0x15, 0x00,                         //       LOGICAL_MINIMUM (0)      
0x27, 0x6f, 0xf5, 0x00, 0x00,       //       LOGICAL_MAXIMUM (62831)        
0x09, 0x3f,                         //       USAGE (Azimuth[Orientation]) 
0x81, 0x02,                         //       INPUT (Data,Var,Abs)  
0xc0,                               //     END_COLLECTION
[...] AND SO ON...
0xc0,                               // END_COLLECTION
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This HID report looks intimidating at first, so let&amp;rsquo;s break this down.&lt;/p&gt;</description>
            <content type="html"><![CDATA[<h2 id="introduction">Introduction</h2>
<p>HID stands for <strong>H</strong>uman <strong>I</strong>nterface <strong>D</strong>evice. It&rsquo;s a device class definition to replace PS/2, was designed for USB but is bus-agnostic.</p>
<p>The HID specification specifies the structure of hid reports, which will be sent from the <em>device</em> (probably your microcontroller) to the <em>host</em> (probably a PC).</p>
<p>A HID report is structured like so:</p>
<pre tabindex="0"><code>0x05, 0x0d,                         // USAGE_PAGE (Digitizers)          
0x09, 0x04,                         // USAGE (Touch Screen)             
0xa1, 0x01,                         // COLLECTION (Application)         
0x85, 0x01,                         //   REPORT_ID (Touch)              
0x09, 0x22,                         //   USAGE (Finger)                 
0xa1, 0x02,                         //     COLLECTION (Logical)  
0x09, 0x42,                         //       USAGE (Tip Switch)           
0x15, 0x00,                         //       LOGICAL_MINIMUM (0)          
0x25, 0x01,                         //       LOGICAL_MAXIMUM (1)          
0x75, 0x01,                         //       REPORT_SIZE (1)              
0x95, 0x01,                         //       REPORT_COUNT (1)             
0x81, 0x02,                         //       INPUT (Data,Var,Abs) 
0x95, 0x07,                         //       REPORT_COUNT (7)  
0x81, 0x03,                         //       INPUT (Cnst,Ary,Abs)
0x75, 0x08,                         //       REPORT_SIZE (8)
0x09, 0x51,                         //       USAGE (Contact Identifier)
0x95, 0x01,                         //       REPORT_COUNT (1)             
0x81, 0x02,                         //       INPUT (Data,Var,Abs) 
0x05, 0x01,                         //       USAGE_PAGE (Generic Desk..
0x26, 0xff, 0x0f,                   //       LOGICAL_MAXIMUM (4095)         
0x75, 0x10,                         //       REPORT_SIZE (16)             
0x55, 0x0e,                         //       UNIT_EXPONENT (-2)           
0x65, 0x13,                         //       UNIT(Inch,EngLinear)                  
0x09, 0x30,                         //       USAGE (X)                    
0x35, 0x00,                         //       PHYSICAL_MINIMUM (0)         
0x46, 0xb5, 0x04,                   //       PHYSICAL_MAXIMUM (1205)
0x95, 0x02,                         //       REPORT_COUNT (2)         
0x81, 0x02,                         //       INPUT (Data,Var,Abs)         
0x46, 0x8a, 0x03,                   //       PHYSICAL_MAXIMUM (906)
0x09, 0x31,                         //       USAGE (Y)                    
0x81, 0x02,                         //       INPUT (Data,Var,Abs)
0x05, 0x0d,                         //       USAGE_PAGE (Digitizers)
0x09, 0x48,                         //       USAGE (Width)                
0x09, 0x49,                         //       USAGE (Height)               
0x81, 0x02,                         //       INPUT (Data,Var,Abs)
0x95, 0x01,                         //       REPORT_COUNT (1)
0x55, 0x0C,                         //       UNIT_EXPONENT (-4)           
0x65, 0x12,                         //       UNIT (Radians,SIROtation)        
0x35, 0x00,                         //       PHYSICAL_MINIMUM (0)         
0x47, 0x6f, 0xf5, 0x00, 0x00,       //       PHYSICAL_MAXIMUM (62831)      
0x15, 0x00,                         //       LOGICAL_MINIMUM (0)      
0x27, 0x6f, 0xf5, 0x00, 0x00,       //       LOGICAL_MAXIMUM (62831)        
0x09, 0x3f,                         //       USAGE (Azimuth[Orientation]) 
0x81, 0x02,                         //       INPUT (Data,Var,Abs)  
0xc0,                               //     END_COLLECTION
[...] AND SO ON...
0xc0,                               // END_COLLECTION
</code></pre><p>This HID report looks intimidating at first, so let&rsquo;s break this down.</p>
<h2 id="analyzing-the-first-three-rows-of-this-hid-report">Analyzing the first three rows of this HID report</h2>
<p><img src="/images/HIDUsage.png" alt="HID Usage"></p>
<h3 id="0x05-0x0d">0x05, 0x0d</h3>
<p>The first byte describes the tag, type, and size of the rest of the data in the line.</p>
<p>These tags, types, and sizes are defined in the HID specification.</p>
<p>Take, for example, 0x05. We break it down into binary form (0000 01 01).</p>
<p>Firstly we have to look at the 0th bit and the 1st bit, which define the size of the data upcoming in bytes. The size in this case is 0b01, which equates to 1, meaning we are expecting 1 byte of information following. (NOTE: Keep in mind that the size of the data is restricted to 0, 1, 2, or 4 (yes 4) bytes long. This also has the implication that 0b11 means FOUR bytes following, not THREE).</p>
<p>Then, the 2nd and 3rd bit define the <em>type</em> of the upcoming data. These are defined in the HID specification like so:</p>
<table>
  <thead>
      <tr>
          <th>Value</th>
          <th>Type Meaning</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>00</td>
          <td>Main Item</td>
      </tr>
      <tr>
          <td>01</td>
          <td>Global Item</td>
      </tr>
      <tr>
          <td>10</td>
          <td>Local Item</td>
      </tr>
      <tr>
          <td>11</td>
          <td>Reserved</td>
      </tr>
  </tbody>
</table>
<p>Pretty simple, right?</p>
<p>The next four bits in this byte indicate the <em>tag</em>. So, let&rsquo;s take our type in this example (01 == Global Item), and manually look through the <code>Device Class Definition for HID 1.11</code> to see what our tag means.</p>
<p>In section <code>6.2.2.7 Global Items</code> of the <code>Device Class Definition for HID 1.11</code>, we see that our tag (0000) means &ldquo;Usage Page&rdquo;. So what have we learned so far? We&rsquo;ve learned that the first byte of HID report is 0x05, expanding into 0000 01 01, telling us that we are going to be reading 1 byte of data, which has type 01 (Global Item), and Tag 0000 (Usage Page).</p>
<p>Next up, let&rsquo;s read our data section. Thankfully, it&rsquo;s only 1 byte, which has the value <em>0x0D</em>. This is where we move to our next document, the HUT (HID Usage Tables).</p>
<p>Simply open up the HUT and CTRL+F to find 0x0D, which takes us to the Digitizers Page.</p>
<h3 id="0x09-0x04">0x09, 0x04</h3>
<p>Let&rsquo;s keep reading. Our next line in the HID report is 0x09, translating to 0000 10 01, meaning we have 1 byte of type local item, and tag 0000. If we follow the same process outlined above, we can see that the <code>Device Class Definition for HID 1.11</code> section <code>6.2.2.8</code> telling us that 0000 tag for a Local Item (10) means that we are about to read a &ldquo;usage&rdquo;. Our usage is 0x04, and when moving to the HID Usage Tables Digitizers Page section, we can see that 0x04 is defined as a Touch Screen.</p>
<h3 id="0xa1-0x01">0xa1, 0x01</h3>
<p>One last time. Let&rsquo;s see what 0xA1 is in binary form; it&rsquo;s 1010 00 01.</p>
<p>Again we will have 1 byte of data (0b01), this time the type will be a Main Item (0b00), and our tag is 1010 (Looking in <code>6.2.2.4 Main Items</code> of the <code>Device Class Definition for HID 1.11</code>, we can see that this means collection). Also in this section, describes that a collection with data byte 0x01 (which is what we have) is an &ldquo;Application&rdquo; type collection.</p>
<h2 id="references">References</h2>
<p>Please see:</p>
<ul>
<li><a href="https://www.usb.org/sites/default/files/hid1_11.pdf">Device Class Definition for HID 1.11</a></li>
<li><a href="https://usb.org/sites/default/files/hut1_5.pdf">HID Usage Tables for USB</a></li>
<li><a href="https://learn.microsoft.com/en-us/windows-hardware/design/component-guidelines/touchscreen-sample-report-descriptors">Sample Report Descriptors</a></li>
</ul>
<p>Also, I want to mention a great tool for automatically parsing HID Report Descriptors, which is <a href="https://eleccelerator.com/usbdescreqparser/">here</a>. Try it out with this HID Report Descriptor:</p>
<p><code>050115000904a1018530050105091901290a150025017501950a5500650081020509190b290e150025017501950481027501950281030b01000100a1000b300001000b310001000b320001000b35000100150027ffff0000751095048102c00b39000100150025073500463b0165147504950181020509190f2912150025017501950481027508953481030600ff852109017508953f8103858109027508953f8103850109037508953f9183851009047508953f9183858009057508953f9183858209067508953f9183c0</code></p>
]]></content>
        </item>
        
    </channel>
</rss>
